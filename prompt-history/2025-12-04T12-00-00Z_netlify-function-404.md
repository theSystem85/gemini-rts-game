# Netlify Function 404 Fix

**UTC Timestamp:** 2025-12-04T12:00:00Z  
**LLM:** Claude (Copilot)

## Prompt Summary

User deployed to Netlify and received 404 errors when attempting WebRTC signalling:
- `POST https://code-and-conquer.netlify.app/api/signalling/offer 404`
- `POST https://code-and-conquer.netlify.app/api/signalling/candidate 404`

The Netlify function logs showed nothing, but the function deployment was successful.

## Root Cause

The issue was a conflict between:
1. The `export const config = { path: '/api/*' }` in the Netlify Function (v2 format)
2. The redirect in `netlify.toml` from `/api/*` to `/.netlify/functions/api/:splat`

These two routing mechanisms were conflicting, causing the requests to not reach the function.

## Changes Made

### 1. `netlify.toml`
- Simplified the redirect from `/api/*` to `/.netlify/functions/api` (removed `:splat`)
- Added `force = false` to SPA fallback to ensure functions/assets are served first

### 2. `netlify/functions/api.js`
- Removed the `export const config = { path: [...], method: [...] }` to avoid conflict with redirects
- Added debug logging to trace incoming requests and normalized paths
- Changed path normalization to handle both `/.netlify/functions/api` and `/api` prefixes

## Files Modified
- `netlify.toml`
- `netlify/functions/api.js`
